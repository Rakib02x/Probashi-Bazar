<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FreshMart ‚Äî‡¶è ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶õ‡¶®‡ßç‡¶¶‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßã‡¶∏‡¶æ‡¶∞‡¶ø</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined" rel="stylesheet" />

   

    <link rel="stylesheet" href="style.css">
</head>
<body>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-analytics.js";
        import { getDatabase, ref, get, set, push } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyADtV06zQSN1mgfHPGyMd9XMrcnaBDbIl8",
            authDomain: "bazar-coltrolpanel.firebaseapp.com",
            projectId: "bazar-coltrolpanel",
            storageBucket: "bazar-coltrolpanel.firebasestorage.app",
            messagingSenderId: "434325187483",
            appId: "1:434325187483:web:2bbdf219d027545798cf3e",
            measurementId: "G-JRFJTKQ2XK"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getDatabase(app);

        // --- Firebase ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ---

        window.fetchData = async (path) => {
            // Firebase Realtime Database ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶Ü‡¶®‡¶æ
            const dataRef = ref(db, path);
            const snapshot = await get(dataRef);
            if (snapshot.exists()) {
                return snapshot.val();
            } else {
                console.log(`No data available at ${path}`);
                return {};
            }
        };

        window.saveUser = async (userData, password) => {
            // user/‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶è‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
            const emailKey = userData.email.replace(/\./g, ','); // ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡ßá‡¶∞ ‡¶°‡¶ü ‡¶ï‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶∞‡¶ø‡¶™‡ßç‡¶≤‡ßá‡¶∏ ‡¶ï‡¶∞‡¶æ
            const userRef = ref(db, `user/${emailKey}`);
            // ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£‡¶§ ‡¶π‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶ï‡¶∞‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶â‡¶ö‡¶ø‡¶§, ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡¶∞‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
            return set(userRef, {...userData, password: password });
        };

        window.loginUser = async (email, password) => {
            // user/‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶è‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
            const emailKey = email.replace(/\./g, ',');
            const userRef = ref(db, `user/${emailKey}`);
            const snapshot = await get(userRef);

            if (snapshot.exists()) {
                const userData = snapshot.val();
                if (userData.password === password) { // ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ö‡ßá‡¶ï
                    return { success: true, user: userData };
                }
            }
            return { success: false, user: null };
        };

        window.saveOrder = async (orderData) => {
            // order ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞‡ßá rendomid ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
            const orderRef = ref(db, 'order');
            return push(orderRef, orderData); // push() ‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∞‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶Æ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá
        };
    </script>

    <header class="shopnow-header-container">
        <div class="header-bar">


            <div class="logo-tex">
                <img class="logo" src="logo.png"> </img>
            </div>

            <div class="icon-group-top">
                <div id="loginBtn" class="search-icon-top">
                    <span class="material-symbols-outlined">
                        person
                    </span>
                    <span id="loginBtnText" class="user-name-text">‡¶≤‡¶ó‡¶á‡¶®</span>
                </div>

                <div class="cart-icon-container" id="cartBtn">
                    <div class="cart-icon">
                        <span class="material-symbols-outlined">
                            shopping_cart
                        </span>
                    </div>
                    <span id="cartCount" class="cart-badge">0</span>
                </div>
            </div>
        </div>

        <div class="search-bar-section">
            <input type="text" id="searchInput" class="search-input-new" placeholder="‡¶Ö‡¶®‡ßÅ‡¶∏‡¶®‡ßç‡¶ß‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®.....">
            <button id="searchButton" class="search-button">‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®</button>
            <div id="suggestionsBox"></div> </div>
    </header>


    <section class="cats">
        <div class="row" id="categoryRow">
        </div>
    </section>

    <section class="hero">
        <div class="slider" id="slider">
            <div class="slides" id="slides">
                <div class="slide">
                    <div class="copy">
                        <span class="tag">‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶°‡ßá‡¶á‡¶≤‡¶ø</span>
                        <h2>‡¶∏‡¶™‡ßç‡¶§‡¶æ‡¶π‡¶ú‡ßÅ‡¶°‡¶º‡ßá ‡¶§‡¶æ‡¶ú‡¶æ ‡¶∏‡¶¨‡¶ú‡¶ø & ‡¶´‡¶≤</h2>
                        <p>‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßÄ‡¶Ø‡¶º ‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‚Äî ‡¶ï‡¶æ‡¶Å‡¶ö‡¶æ‡¶Æ‡¶æ‡¶≤, ‡¶≠‡¶æ‡¶≤‡ßã ‡¶¶‡¶æ‡¶Æ‡ßá‡•§</p>
                        <button class="btn" onclick="scrollToProducts()">‡¶∂‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    </div>
                    <img src="https://images.unsplash.com/photo-1542838132-92c53300491e?w=1200&q=60&auto=format&fit=crop" alt="banner1">
                </div>
                <div class="slide">
                    <div class="copy">
                        <span class="tag">‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶°‡¶ø‡¶≤‡¶∏</span>
                        <h2>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶õ‡¶æ‡¶°‡¶º</h2>
                        <p>‡¶®‡¶ø‡¶§‡ßç‡¶Ø‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßÄ‡¶Ø‡¶º ‡¶™‡¶£‡ßç‡¶Ø‡ßá ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶õ‡¶æ‡¶°‡¶º ‚Äî ‡¶Æ‡¶ú‡ßÅ‡¶¶ ‡¶∏‡ßÄ‡¶Æ‡¶ø‡¶§‡•§</p>
                        <button class="btn" onclick="scrollToProducts()">‡¶°‡¶ø‡¶≤ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                    </div>
                    <img src="https://images.unsplash.com/photo-1498654208925-3a3f6c8f6a91?w=1200&q=60&auto=format&fit=crop" alt="banner2">
                </div>
            </div>
            <div class="controls">
                <div class="ctrl" onclick="prevSlide()">‚óÄ</div>
                <div class="ctrl" onclick="nextSlide()">‚ñ∂</div>
            </div>
        </div>
    </section>

    <main class="container" id="productsContainer">
    </main>

    <footer>
        <div class="footer-grid">
            <div>
                <h4>FreshMart</h4>
                <p class="muted">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶∂‡ßá‡¶™‡¶æ‡¶∂‡ßá‡¶∞ ‡¶§‡¶æ‡¶ú‡¶æ ‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞ ‚Äî ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø, ‡¶∏‡¶π‡¶ú ‡¶∞‡¶ø‡¶ü‡¶æ‡¶∞‡ßç‡¶®, ‡¶∏‡ßá‡¶∞‡¶æ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡•§</p>
                <div class="socials">
                    <a aria-label="facebook" href="#" style="color:#3b5998">üîµ</a>
                    <a aria-label="instagram" href="#" style="color:#c32aa3">üì∏</a>
                    <a aria-label="tw" href="#" style="color:#00acee">üê¶</a>
                </div>
            </div>
            <div>
                <h4>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø‡¶∏</h4>
                <p class="muted">‡¶∏‡¶¨‡¶ú‡¶ø<br>‡¶´‡¶≤<br>‡¶¶‡ßÅ‡¶ß & ‡¶°‡ßá‡¶á‡¶∞‡¶ø<br>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶™‡¶≤‡¶∏</p>
            </div>
            <div>
                <h4>‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</h4>
                <p class="muted">‡¶π‡ßá‡¶≤‡ßç‡¶™ ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞<br>‡¶∂‡¶ø‡¶™‡¶ø‡¶Ç & ‡¶∞‡¶ø‡¶ü‡¶æ‡¶∞‡ßç‡¶®<br>‡¶ï‡¶®‡¶ü‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü</p>
            </div>
            <div>
                <h4>‡¶®‡¶ø‡¶â‡¶ú‡¶≤‡ßá‡¶ü‡¶æ‡¶∞</h4>
                <p class="muted">‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶°‡¶ø‡¶∏‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶™‡ßá‡¶§‡ßá ‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶¨ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                <div style="margin-top:8px;display:flex;gap:8px">
                    <input placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" style="padding:8px;border-radius:8px;border:none;flex:1">
                    <button class="btn">‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶¨</button>
                </div>
            </div>
        </div>
        <p style="text-align:center;color:#94a3b8;margin-top:18px">¬© 2025 FreshMart ‚Ä¢ ‡¶∏‡¶ï‡¶≤ ‡¶Ö‡¶ß‡¶ø‡¶ï‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§</p>
    </footer>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-modal-btn">&times;</span>
            <h2 id="modalTitle">‡¶≤‡¶ó‡¶á‡¶®</h2>
            <form id="loginForm" class="login-form active">
                <div class="form-group"><input type="email" id="loginEmail" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤" required></div>
                <div class="form-group"><input type="password" id="loginPassword" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°" required></div>
                <button type="submit" class="btn">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <p class="switch-link">‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á? <span id="switchToRegister">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</span></p>
            </form>

            <form id="registerForm" class="login-form">
                <div class="form-group"><input type="text" id="regName" placeholder="‡¶®‡¶æ‡¶Æ" required></div>
                <div class="form-group"><input type="email" id="regEmail" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤" required></div>
                <div class="form-group"><input type="tel" id="regNumber" placeholder="‡¶´‡ßã‡¶® ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞" required></div>
                <div class="form-group"><input type="text" id="regAddress" placeholder="‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ" required></div>
                <div class="form-group"><input type="password" id="regPassword" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°" required></div>
                <button type="submit" class="btn">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</button>
                <p class="switch-link">‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá? <span id="switchToLogin">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</span></p>
            </form>
        </div>
    </div>

    <div id="variantSheet" class="bottom-sheet">
        <div class="sheet-content">
            <button class="close-modal-btn" id="closeSheetBtn">&times;</button>
            <div class="sheet-details">
                <img id="sheetProductImage" src="https://via.placeholder.com/80" alt="Product" class="sheet-prod-img">
                <div class="details-text">
                    <h3 id="sheetProductName" style="margin:0;">‡¶Ü‡¶≤‡ßÅ</h3>
                    <p id="sheetProductPricePerUnit" class="muted" style="margin:4px 0 0;">RM ‡ß®‡ß¶/‡¶ï‡ßá‡¶ú‡¶ø</p>
                </div>
            </div>

            <h4 class="sheet-sub-title">‡¶≠‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:</h4>
            <div id="variantChoices" class="variant-choices">
            </div>

            <div class="sheet-action-bar">
                <div class="price-display">
                    ‡¶Æ‡ßã‡¶ü ‡¶¶‡¶æ‡¶Æ: RN <span id="totalPriceDisplay">0.00</span>
                </div>
                <button id="addToCartConfirmBtn" class="btn">‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</button>
            </div>
        </div>
    </div>

    <aside id="cartSidebar" class="cart-sidebar">
        <div class="sidebar-header">
            <h3>‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ó (<span id="sidebarCartCount">0</span>)</h3>
            <button class="close-sidebar-btn">&times;</button>
        </div>
        <div class="cart-items" id="cartItemsList">
            <p class="empty-cart-msg">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ó ‡¶ñ‡¶æ‡¶≤‡¶ø‡•§</p>
        </div>
        <div class="sidebar-footer">
            <div class="checkout-total">
                <p>‡¶Æ‡ßã‡¶ü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø:</p>
                <p>RM <span id="checkoutTotalAmount">0.00</span></p>
            </div>
            <button class="checkout-btn online-payment-btn"><i class="fas fa-credit-card"></i> ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button id="cashOnDeliveryBtn" class="checkout-btn cod-btn pulse-animation"><i class="fas fa-truck"></i> ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶Ö‡¶® ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø</button>
        </div>
    </aside>

    <div id="codModal" class="modal">
        <div class="modal-content">
            <span class="close-modal-btn">&times;</span>
            <h2>‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶§‡¶•‡ßç‡¶Ø</h2>
            <form id="codForm" class="cod-form">
                <div class="form-group"><input type="text" id="codName" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ" required></div>
                <div class="form-group"><input type="tel" id="codNumber" placeholder="‡¶´‡ßã‡¶® ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞" required></div>
                <div class="form-group"><input type="text" id="codAddress" placeholder="‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø‡¶∞ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ" required></div>

                <div class="order-summary">
                    <h4>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶∞‡¶ø:</h4>
                    <p>‡¶Æ‡ßã‡¶ü ‡¶™‡ßç‡¶∞‡¶°‡¶æ‡¶ï‡ßç‡¶ü: <span id="codTotalItems">0</span> ‡¶ü‡¶ø</p>
                    <p style="font-size:1.1rem; font-weight:bold;">‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶≤: RM <span id="codTotalBill">0.00</span></p>
                </div>

                <button type="submit" class="btn confirm-btn">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </form>
        </div>
    </div>

    <script>
        // ‡¶ú‡¶æ‡¶≠‡¶æ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶∂‡ßÅ‡¶∞‡ßÅ
        document.addEventListener('DOMContentLoaded', () => {
            // DOM ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ)
            const loginModal = document.getElementById('loginModal');
            const loginBtn = document.getElementById('loginBtn');
            const closeModals = document.querySelectorAll('.close-modal-btn');
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const switchToRegister = document.getElementById('switchToRegister');
            const switchToLogin = document.getElementById('switchToLogin');
            const modalTitle = document.getElementById('modalTitle');

            const variantSheet = document.getElementById('variantSheet');
            const closeSheetBtn = document.getElementById('closeSheetBtn');
            const productsContainer = document.getElementById('productsContainer');
            const variantChoices = document.getElementById('variantChoices');
            const totalPriceDisplay = document.getElementById('totalPriceDisplay');
            const addToCartConfirmBtn = document.getElementById('addToCartConfirmBtn');

            const cartSidebar = document.getElementById('cartSidebar');
            const cartBtn = document.getElementById('cartBtn');
            const closeSidebarBtn = document.querySelector('.close-sidebar-btn');
            const cartCount = document.getElementById('cartCount');
            const sidebarCartCount = document.getElementById('sidebarCartCount');
            const cartItemsList = document.getElementById('cartItemsList');
            const checkoutTotalAmount = document.getElementById('checkoutTotalAmount');

            const cashOnDeliveryBtn = document.getElementById('cashOnDeliveryBtn');
            const codModal = document.getElementById('codModal');
            const codForm = document.getElementById('codForm');
            const codTotalBill = document.getElementById('codTotalBill');
            const codTotalItems = document.getElementById('codTotalItems');

            // --- ‡¶®‡¶§‡ßÅ‡¶® DOM ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ---
            const searchInput = document.getElementById('searchInput');
            const searchButton = document.getElementById('searchButton');
            const suggestionsBox = document.getElementById('suggestionsBox');
            // ---

            let currentProduct = null;
            let selectedVariant = null;
            let cart = [];
            let loggedInUser = null;
            let allProducts = []; // ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ

            // --- ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ---
            async function loadData() {
                try {
                    // Firebase ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶°‡ßá‡¶ü‡¶æ fetchCategories() ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ü‡¶®‡¶¨‡ßá
                    const categoryData = await window.fetchData('catagory');
                    const productData = await window.fetchData('product');

                    // ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ
                    if (productData) {
                        allProducts = Object.keys(productData).map(key => ({
                            id: key,
                            ...productData[key]
                        }));
                    }
                    
                    renderCategories(categoryData);
                    renderProducts(allProducts); // ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ

                } catch (error) {
                    console.error("Firebase ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", error);
                    // ‡¶´‡ßá‡¶á‡¶ï ‡¶°‡ßá‡¶ü‡¶æ ‡¶¨‡¶æ ‡¶™‡ßç‡¶≤‡ßá‡¶∏‡¶π‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá UI ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá
                }
            }

            function renderCategories(categoryData) {
                const categoryRow = document.getElementById('categoryRow');
                categoryRow.innerHTML = '';

                if (categoryData) {
                    Object.keys(categoryData).forEach(key => {
                        const cat = categoryData[key];
                        const el = document.createElement('div'); el.className='cat';
                        // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ID ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶¨‡ßç‡¶≤‡¶ï‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
                        el.dataset.catId = cat.name.replace(/\s+/g, '-');
                        el.innerHTML = `<img src="${cat.image}" alt="${cat.name}"><p>${cat.name}</p>`;
                        categoryRow.appendChild(el);
                    });
                }
            }

            function renderProducts(productsArr) {
                productsContainer.innerHTML = '';
                const groupedProducts = {};

                // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™‡¶ø‡¶Ç
                if (productsArr.length > 0) {
                    productsArr.forEach(prod => {
                        const catName = prod['catagory name'];
                        if (!groupedProducts[catName]) {
                            groupedProducts[catName] = [];
                        }
                        groupedProducts[catName].push(prod);
                    });
                } else if (searchInput.value.trim() !== "") {
                     // ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞‡ßá‡¶ì ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶®‡¶æ ‡¶™‡ßá‡¶≤‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
                    productsContainer.innerHTML = '<p style="text-align:center; padding:20px; font-size:1.2em;">‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶è‡¶á ‡¶®‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§</p>';
                    return; // ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶Ü‡¶∞ ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶®‡ßá‡¶á
                }

                // ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ
                Object.keys(groupedProducts).forEach(catName => {
                    const catId = catName.replace(/\s+/g, '-');
                    // ‡¶Ø‡¶ñ‡¶® ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá ‡¶§‡¶ñ‡¶® category-block ‡¶è‡¶∞ id ‡¶è‡¶∞ ‡¶∂‡ßá‡¶∑‡ßá '-block' ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá, ‡¶Ø‡¶æ‡¶§‡ßá scrollIntoView ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§
                    const blockId = searchInput.value.trim() === "" ? catId + '-block' : catId + '-search-block'; // ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ id
                    const block = document.createElement('section'); block.className='category-block'; block.id = blockId;
                    block.innerHTML = `<h3>${catName}</h3><div class="products"></div>`;
                    const grid = block.querySelector('.products');

                    groupedProducts[catName].forEach(prod => {
                        const card = document.createElement('div'); card.className='card';
                        // Add to Cart ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßÄ‡¶Ø‡¶º ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
                        card.innerHTML = `
                            <img src="${prod['product image']}" alt="${prod['products name']}">
                            <div class="name">${prod['products name']}</div>
                            <div class="price">RM ${prod['product price']} <span class="price-per">/‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ï‡ßá‡¶ú‡¶ø</span></div>
                            <div style="margin-top:auto;">
                                <button class="btn add-to-cart-trigger"
                                    data-id="${prod.id}"
                                    data-name="${prod['products name']}"
                                    data-image="${prod['product image']}"
                                    data-price="${prod['product price']}"
                                    data-variants="${prod['product variant']}"
                                    >‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</button>
                            </div>
                        `;
                        grid.appendChild(card);
                    });
                    productsContainer.appendChild(block);
                });
            }

            // --- ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶≤‡¶ú‡¶ø‡¶ï ---
            function performSearch(query) {
                const lowerCaseQuery = query.toLowerCase().trim();
                if (lowerCaseQuery === "") {
                    renderProducts(allProducts); // ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶π‡¶≤‡ßá ‡¶∏‡¶¨ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
                    return;
                }

                const filteredProducts = allProducts.filter(product => 
                    product['products name'].toLowerCase().includes(lowerCaseQuery)
                );
                
                renderProducts(filteredProducts);
            }

            // ‡¶∏‡¶æ‡¶ú‡ßá‡¶∂‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
            function showSuggestions(query) {
                suggestionsBox.innerHTML = '';
                const lowerCaseQuery = query.toLowerCase().trim();

                if (lowerCaseQuery.length < 2) {
                    return; // ‡ß® ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶ï‡¶Æ ‡¶π‡¶≤‡ßá ‡¶∏‡¶æ‡¶ú‡ßá‡¶∂‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶®‡ßá‡¶á
                }

                const matchedProducts = allProducts.filter(product => 
                    product['products name'].toLowerCase().includes(lowerCaseQuery)
                ).slice(0, 5); // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡ß´‡¶ü‡¶ø ‡¶∏‡¶æ‡¶ú‡ßá‡¶∂‡¶®

                matchedProducts.forEach(product => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';
                    item.innerHTML = `<img src="${product['product image']}" alt="${product['products name']}"> ${product['products name']}`;
                    
                    item.addEventListener('click', () => {
                        searchInput.value = product['products name'];
                        performSearch(product['products name']);
                        suggestionsBox.innerHTML = ''; // ‡¶∏‡¶æ‡¶ú‡ßá‡¶∂‡¶® ‡¶¨‡¶®‡ßç‡¶ß
                    });

                    suggestionsBox.appendChild(item);
                });
            }

            // ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.trim();
                showSuggestions(query);

            // **‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ú‡¶®:** ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶π‡¶≤‡ßá ‡¶∏‡¶¨ ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì
               if (query === "") {
               performSearch(""); // performSearch ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶Ç ‡¶™‡ßá‡¶≤‡ßá ‡¶∏‡¶¨ ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶õ‡ßá
               }
});    

            // ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü
            searchButton.addEventListener('click', () => {
                performSearch(searchInput.value);
                suggestionsBox.innerHTML = ''; // ‡¶∏‡¶æ‡¶ú‡ßá‡¶∂‡¶® ‡¶¨‡¶®‡ßç‡¶ß
            });

            // ‡¶Ø‡¶ñ‡¶® ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶è‡¶∞ ‡¶¨‡¶æ‡¶á‡¶∞‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá, ‡¶§‡¶ñ‡¶® ‡¶∏‡¶æ‡¶ú‡ßá‡¶∂‡¶® ‡¶¨‡¶ï‡ßç‡¶∏ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.search-bar-section')) {
                    suggestionsBox.innerHTML = '';
                }
            });

            // --- ‡¶á‡¶â‡¶ü‡¶ø‡¶≤‡¶ø‡¶ü‡¶ø ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---

            // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶ï‡¶∞‡¶æ
            document.getElementById('categoryRow').addEventListener('click', (e) => {
                const catEl = e.target.closest('.cat');
                if (catEl && catEl.dataset.catId) {
                    // ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶¨ ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá
                    searchInput.value = "";
                    renderProducts(allProducts);
                    setTimeout(() => { // ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø setTimeout
                        const targetBlock = document.getElementById(catEl.dataset.catId + '-block');
                        if (targetBlock) {
                            targetBlock.scrollIntoView({behavior:'smooth',block:'start'});
                        }
                    }, 50);
                }
            });

            // ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
            function calculatePrice(pricePerUnit, variant) {
                const variantText = variant.toLowerCase().trim();
                let quantityInKg = 0;

                if (variantText.endsWith('kg')) {
                    quantityInKg = parseFloat(variantText.replace('kg', ''));
                } else if (variantText.endsWith('g')) {
                    quantityInKg = parseFloat(variantText.replace('g', '')) / 1000;
                } else if (variantText.endsWith('litre')) {
                       quantityInKg = parseFloat(variantText.replace('litre', '')); // ‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞‡¶ï‡ßá kg ‡¶è‡¶∞ ‡¶∏‡¶Æ‡¶§‡ßÅ‡¶≤‡ßç‡¶Ø ‡¶ß‡¶∞‡¶æ
                }
                // "‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶™‡¶ø‡¶∏/‡¶Ü‡¶ü‡¶ø" ‡¶á‡¶§‡ßç‡¶Ø‡¶æ‡¶¶‡¶ø‡¶∞ ‡¶ï‡ßç‡¶∑‡ßá‡¶§‡ßç‡¶∞‡ßá ‡¶Ø‡¶¶‡¶ø ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶¶‡¶æ‡¶Æ ‡¶π‡¶Ø‡¶º, ‡¶§‡¶¨‡ßá ‡ßß ‡¶ß‡¶∞‡¶æ
                else {
                    quantityInKg = 1;
                }

                return pricePerUnit * quantityInKg;
            }

            // ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
            function updateCart() {
                const totalItems = cart.length;
                const totalAmount = cart.reduce((sum, item) => sum + item.totalPrice, 0);

                cartCount.textContent = totalItems;
                sidebarCartCount.textContent = totalItems;
                checkoutTotalAmount.textContent = totalAmount.toFixed(2);
                codTotalBill.textContent = totalAmount.toFixed(2);
                codTotalItems.textContent = totalItems;

                cartItemsList.innerHTML = '';
                if (cart.length === 0) {
                    cartItemsList.innerHTML = '<p class="empty-cart-msg">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ó ‡¶ñ‡¶æ‡¶≤‡¶ø‡•§</p>';
                } else {
                    // ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞
                    cart.forEach((item, index) => {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'cart-item';
                        itemDiv.innerHTML = `
                            <div class="cart-item-details">
                                <img src="${item.image}" alt="${item.name}" style="width:40px; height:40px; object-fit:cover; border-radius:5px;">
                                <div>
                                    <p style="font-weight:600; font-size:14px;">${item.name}</p>
                                    <p class="muted" style="font-size:12px;">${item.variant}</p>
                                </div>
                            </div>
                            <div style="text-align:right;">
                                <p style="color:var(--accent-2); font-weight:700;">RM ${item.totalPrice.toFixed(2)}</p>
                                <button class="remove-cart-item-btn" data-index="${index}">&times;</button>
                            </div>
                        `;
                        cartItemsList.appendChild(itemDiv);
                    });
                }

                // ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞
                document.querySelectorAll('.remove-cart-item-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const indexToRemove = parseInt(e.currentTarget.dataset.index);
                        cart.splice(indexToRemove, 1);
                        updateCart();
                    });
                });
            }

            // --- ‡¶≤‡¶ó‡¶á‡¶®/‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶≤‡¶ú‡¶ø‡¶ï ---
            loginBtn.addEventListener('click', () => {
                loginModal.style.display = 'block';
            });

            closeModals.forEach(btn => {
                btn.addEventListener('click', () => {
                    loginModal.style.display = 'none';
                    codModal.style.display = 'none';
                });
            });

            window.onclick = (event) => {
                if (event.target == loginModal) {loginModal.style.display = 'none';}
                if (event.target == codModal) {codModal.style.display = 'none';}
            };

            switchToRegister.addEventListener('click', () => {
                loginForm.classList.remove('active');
                registerForm.classList.add('active');
                modalTitle.textContent = '‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡ßÄ ‡¶ï‡¶∞‡ßÅ‡¶®';
            });

            switchToLogin.addEventListener('click', () => {
                registerForm.classList.remove('active');
                loginForm.classList.add('active');
                modalTitle.textContent = '‡¶≤‡¶ó‡¶á‡¶®';
            });

            // ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï
            registerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('regEmail').value;
                const name = document.getElementById('regName').value;
                const number = document.getElementById('regNumber').value;
                const address = document.getElementById('regAddress').value;
                const password = document.getElementById('regPassword').value;

                try {
                    await window.saveUser({ email, name, number, address, password }, password); // password field ‡¶∏‡ßá‡¶≠ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
                    alert('‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡¶´‡¶≤! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ñ‡¶® ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§');
                    switchToLogin.click();
                } catch (error) {
                    alert('‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ' + error.message);
                }
            });

            // ‡¶≤‡¶ó‡¶á‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;

                try {
                    const result = await window.loginUser(email, password);
                    if (result.success) {
                        loggedInUser = result.user;
                        loginModal.style.display = 'none';
                        // ‡¶π‡ßá‡¶°‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£‡ßá ‡¶è‡¶á ‡¶≤‡¶æ‡¶á‡¶®‡¶ü‡¶ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá
                        const loginBtnText = document.getElementById('loginBtnText');
                        if (loginBtnText) {
                            loginBtnText.textContent = loggedInUser.name.split(' ')[0] || '‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü';
                        }

                        alert('‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤!');
                    } else {
                         alert('‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤‡•§');
                    }
                } catch (error) {
                    alert('‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ' + error.message);
                }
            });

            // --- ‡¶≠‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶ü‡¶Æ ‡¶∂‡ßÄ‡¶ü ‡¶≤‡¶ú‡¶ø‡¶ï ---

            productsContainer.addEventListener('click', (e) => {
                const btn = e.target.closest('.add-to-cart-trigger');
                if (btn) {
                    const variants = btn.dataset.variants.split(',');
                    const price = parseFloat(btn.dataset.price);
                    const name = btn.dataset.name;
                    const image = btn.dataset.image;
                    const productId = btn.dataset.id;

                    currentProduct = { id: productId, name, image, price, variants };
                    selectedVariant = null;

                    document.getElementById('sheetProductImage').src = image;
                    document.getElementById('sheetProductName').textContent = name;
                    document.getElementById('sheetProductPricePerUnit').textContent = `RM ${price.toFixed(2)}/‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ï‡ßá‡¶ú‡¶ø`;

                    variantChoices.innerHTML = '';
                    variants.forEach(variant => {
                        const cleanVariant = variant.trim();
                        const btn = document.createElement('button');
                        btn.className = 'variant-btn';
                        btn.textContent = cleanVariant;
                        btn.dataset.variant = cleanVariant;
                        variantChoices.appendChild(btn);
                    });

                    totalPriceDisplay.textContent = '0.00';
                    variantSheet.classList.add('active');
                }
            });

            closeSheetBtn.addEventListener('click', () => {
                variantSheet.classList.remove('active');
            });

            variantChoices.addEventListener('click', (e) => {
                const btn = e.target.closest('.variant-btn');
                if (btn) {
                    document.querySelectorAll('.variant-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    selectedVariant = btn.dataset.variant;

                    const totalPrice = calculatePrice(currentProduct.price, selectedVariant);
                    totalPriceDisplay.textContent = totalPrice.toFixed(2);
                }
            });

            // ‡¶ï‡¶ø‡¶®‡ßÅ‡¶® (Add to Cart) ‡¶≤‡¶ú‡¶ø‡¶ï
            addToCartConfirmBtn.addEventListener('click', (e) => {
                if (!selectedVariant) {
                    alert('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶≠‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                    return;
                }

                const totalPrice = parseFloat(totalPriceDisplay.textContent);
                const newItem = {
                    id: currentProduct.id,
                    name: currentProduct.name,
                    image: currentProduct.image,
                    pricePerUnit: currentProduct.price,
                    variant: selectedVariant,
                    totalPrice: totalPrice
                };

                cart.push(newItem);
                updateCart();
                variantSheet.classList.remove('active');

                // --- Fly to Cart Animation ---
                const cartRect = document.querySelector('#cartBtn').getBoundingClientRect(); // ‡¶®‡¶§‡ßÅ‡¶® ‡¶π‡ßá‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ID ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞
                const sheetRect = variantSheet.getBoundingClientRect();

                const flyingImg = document.createElement('img');
                flyingImg.src = currentProduct.image;
                flyingImg.className = 'flying-product';

                // ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßç‡¶ü‡¶ø‡¶Ç ‡¶™‡¶ú‡¶ø‡¶∂‡¶®: ‡¶¨‡¶ü‡¶Æ ‡¶∂‡ßÄ‡¶ü‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶á‡¶Æ‡ßá‡¶ú ‡¶•‡ßá‡¶ï‡ßá
                flyingImg.style.left = `${sheetRect.left + 28}px`;
                flyingImg.style.top = `${sheetRect.top + 30}px`;

                // ‡¶°‡ßá‡¶∏‡ßç‡¶ü‡¶ø‡¶®‡ßá‡¶∂‡¶® ‡¶™‡¶ú‡¶ø‡¶∂‡¶®: ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶Ü‡¶á‡¶ï‡¶®‡ßá (CSS variable ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ)
                document.documentElement.style.setProperty('--dx', `${cartRect.left - (sheetRect.left + 28)}px`);
                document.documentElement.style.setProperty('--dy', `${cartRect.top - (sheetRect.top + 30)}px`);

                document.body.appendChild(flyingImg);

                setTimeout(() => {
                    flyingImg.remove();
                    if(cart.length === 1) {
                        cartSidebar.classList.add('open'); // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶≤‡ßá ‡¶∏‡¶æ‡¶á‡¶°‡¶¨‡¶æ‡¶∞ ‡¶Ö‡¶ü‡ßã ‡¶ì‡¶™‡ßá‡¶®
                    }
                }, 800);
            });

            // --- ‡¶ï‡ßÅ‡¶á‡¶ï ‡¶ö‡ßá‡¶ï‡¶Ü‡¶â‡¶ü ‡¶∏‡¶æ‡¶á‡¶°‡¶¨‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï ---

            cartBtn.addEventListener('click', () => {
                cartSidebar.classList.toggle('open');
            });

            closeSidebarBtn.addEventListener('click', () => {
                cartSidebar.classList.remove('open');
            });

            // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶Ö‡¶® ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï
            cashOnDeliveryBtn.addEventListener('click', () => {
                if (cart.length === 0) {
                    alert('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ó‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶®‡ßá‡¶á‡•§');
                    return;
                }

                // ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶ø-‡¶´‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ
                if (loggedInUser) {
                    document.getElementById('codName').value = loggedInUser.name || '';
                    document.getElementById('codNumber').value = loggedInUser.number || '';
                    document.getElementById('codAddress').value = loggedInUser.address || '';
                } else {
                    // ‡¶≤‡¶ó‡¶á‡¶® ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá, ‡¶´‡¶∞‡ßç‡¶Æ ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶ï‡¶∞‡¶æ
                    document.getElementById('codName').value = '';
                    document.getElementById('codNumber').value = '';
                    document.getElementById('codAddress').value = '';
                }

                codModal.style.display = 'block';
            });

            // ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶® (COD) ‡¶≤‡¶ú‡¶ø‡¶ï
            codForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const name = document.getElementById('codName').value;
                const number = document.getElementById('codNumber').value;
                const address = document.getElementById('codAddress').value;

                // item ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶Ç ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ: "‡¶Ü‡¶≤‡ßÅ-1kg-RM 2-pending,‡¶ü‡¶Æ‡ßá‡¶ü‡ßã-500g-RM 1-pending"
                const itemString = cart.map(item =>
                    `${item.name}-${item.variant}-RM ${item.totalPrice.toFixed(2)}-pending`
                ).join(',');

                const orderData = {
                    name: name,
                    number: number,
                    address: address,
                    item: itemString,
                    status: 'pending'
                };

                try {
                    await window.saveOrder(orderData); // Firebase-‡¶è ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ
                    alert('‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶ñ‡ßÅ‡¶¨ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§');

                    // ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
                    codModal.style.display = 'none';
                    cart = [];
                    updateCart();
                    cartSidebar.classList.remove('open');
                } catch (error) {
                    alert('‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ' + error.message);
                }
            });

            // --- ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶® ---
            loadData();
            updateCart(); // ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú ‡¶ï‡¶∞‡¶æ

            // ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶ï‡ßã‡¶°)
            let slideIndex=0; const slidesEl = document.getElementById('slides');
            window.showSlide = (i) => {
              const total = slidesEl.children.length; slideIndex = (i + total) % total;
              slidesEl.style.transform = `translateX(-${slideIndex*100}%)`;
            }
            window.nextSlide = () => { showSlide(slideIndex+1); }
            window.prevSlide = () => { showSlide(slideIndex-1); }
            setInterval(window.nextSlide,5000);
            window.scrollToProducts = () => { document.getElementById('productsContainer').scrollIntoView({behavior:'smooth'}) }
        });
    </script>
</body>
</html>